<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>{{ i18n.t('USER_DASHBOARD_TITLE', lang) }}</title>
	<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
	<div class="container mx-auto p-6">
		<h1 class="text-3xl font-bold mb-6">{{ i18n.t('USER_DASHBOARD_TITLE', lang) }}</h1>

		<!-- Tabs -->
		<div class="border-b border-gray-200">
			<nav class="-mb-px flex space-x-8" aria-label="Tabs">
				<a href="#products" class="tab-link border-b-2 border-transparent px-1 py-4 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300">{{ i18n.t('PRODUCTS_TAB', lang) }}</a>
				<a href="#orders" class="tab-link border-b-2 border-transparent px-1 py-4 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300">{{ i18n.t('ORDERS_TAB', lang) }}</a>
				<a href="#statistics" class="tab-link border-b-2 border-transparent px-1 py-4 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300">{{ i18n.t('DASHBOARD_STATISTICS_TAB', lang) }}</a>
				<a href="#configuration" class="tab-link border-b-2 border-transparent px-1 py-4 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300">{{ i18n.t('DASHBOARD_CONFIGURATION_TAB', lang) }}</a>
			</nav>
		</div>

		<!-- Products Tab -->
		<div id="products" class="tab-content hidden mt-6">
			<!-- Add Product Form -->
			<div class="bg-white p-6 rounded-lg shadow-md mb-6">
				<h2 class="text-2xl font-semibold mb-4">{{ i18n.t('PRODUCT_ADD', lang) }}</h2>
				<form action="/dashboard/add_product" method="POST" enctype="multipart/form-data" class="space-y-4">
					<div>
						<label for="type" class="block text-sm font-medium text-gray-700">{{ i18n.t('TYPE', lang) }}</label>
						<select id="type" name="type" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
							<option value="shipped">{{ i18n.t('PRODUCT_TYPE_SHIPPED', lang) }}</option>
							<option value="download">{{ i18n.t('PRODUCT_TYPE_DOWNLOAD', lang) }}</option>
							<option value="membership">{{ i18n.t('PRODUCT_TYPE_MEMBERSHIP', lang) }}</option>
						</select>
					</div>
					<div>
						<label for="name" class="block text-sm font-medium text-gray-700">{{ i18n.t('NAME', lang) }}</label>
						<input type="text" id="name" name="name" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
					</div>
					<div>
						<label for="description" class="block text-sm font-medium text-gray-700">{{ i18n.t('DESCRIPTION', lang) }}</label>
						<textarea id="description" name="description" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></textarea>
					</div>
					<div>
						<label for="price" class="block text-sm font-medium text-gray-700">{{ i18n.t('PRICE', lang) }} (TL)</label>
						<input type="number" id="price" name="price" step="0.01" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
					</div>
					<div id="shipped-fields" class="hidden">
						<div>
							<label for="quantity" class="block text-sm font-medium text-gray-700">{{ i18n.t('QUANTITY', lang) }}</label>
							<input type="number" id="quantity" name="quantity" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
						</div>
						<div>
							<label for="tax_rates" class="block text-sm font-medium text-gray-700">{{ i18n.t('SELL_ENTER_TAX_RATES', lang) }}</label>
							<input type="text" id="tax_rates" name="tax_rates" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
						</div>
						<div>
							<label for="shipping_fee" class="block text-sm font-medium text-gray-700">{{ i18n.t('SELL_ENTER_SHIPPING_FEE', lang) }} (TL)</label>
							<input type="number" id="shipping_fee" name="shipping_fee" step="0.01" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
						</div>
					</div>
					<div id="membership-fields" class="hidden">
						<div>
							<label for="group_id" class="block text-sm font-medium text-gray-700">{{ i18n.t('GROUP_ID', lang) }}</label>
							<input type="number" id="group_id" name="group_id" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
						</div>
						<div>
							<label for="duration" class="block text-sm font-medium text-gray-700">{{ i18n.t('SELL_ENTER_MEMBERSHIP_DETAILS', lang) }}</label>
							<select id="duration" name="duration" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
								<option value="lifetime">Lifetime</option>
								<option value="yearly">Yearly</option>
								<option value="monthly">Monthly</option>
								<option value="weekly">Weekly</option>
							</select>
						</div>
					</div>
					<div id="download-fields" class="hidden">
						<div>
							<label for="file" class="block text-sm font-medium text-gray-700">{{ i18n.t('SELL_UPLOAD_FILE', lang) }}</label>
							<input type="file" id="file" name="file" accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.png,.gif,.mp4,.zip,.apk,.stl,.xcf" class="mt-1 block w-full">
						</div>
					</div>
					<div>
						<label for="images" class="block text-sm font-medium text-gray-700">{{ i18n.t('SELL_UPLOAD_IMAGES', lang) }}</label>
						<input type="file" id="images" name="images[]" multiple accept="image/*" class="mt-1 block w-full">
					</div>
					<button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700">{{ i18n.t('PRODUCT_ADD', lang) }}</button>
				</form>
			</div>

			<!-- Product List -->
			<div class="bg-white p-6 rounded-lg shadow-md">
				<h2 class="text-2xl font-semibold mb-4">{{ i18n.t('PRODUCTS_TITLE', lang) }}</h2>
				{% if products %}
					<table class="w-full table-auto">
						<thead>
							<tr class="bg-gray-200">
								<th class="px-4 py-2">{{ i18n.t('NAME', lang) }}</th>
								<th class="px-4 py-2">{{ i18n.t('TYPE', lang) }}</th>
								<th class="px-4 py-2">{{ i18n.t('PRICE', lang) }} (TL)</th>
								<th class="px-4 py-2">{{ i18n.t('PRODUCT_TOP_SALE', lang) }}</th>
								<th class="px-4 py-2">{{ i18n.t('ACTIONS', lang) }}</th>
							</tr>
						</thead>
						<tbody>
							{% for product in products %}
								<tr>
									<td class="border px-4 py-2">{{ product.name }}{% if product.features.is_top_sale %} ðŸ”¥{% endif %}</td>
									<td class="border px-4 py-2">{{ i18n.t('PRODUCT_TYPE_' + product.type.upper()) }}</td>
									<td class="border px-4 py-2">{{ product.price }}</td>
									<td class="border px-4 py-2">{{ i18n.t('YES') if product.features.is_top_sale else i18n.t('NO', lang) }}</td>
									<td class="border px-4 py-2">
										<a href="/dashboard/edit_product/{{ product.id }}" class="text-blue-600 hover:underline">{{ i18n.t('PRODUCT_EDIT', lang) }}</a>
										<a href="/dashboard/delete_product/{{ product.id }}" class="text-red-600 hover:underline ml-2" onclick="return confirm('{{ i18n.t('PRODUCT_DELETE_CONFIRM', lang) }}')">{{ i18n.t('PRODUCT_DELETE', lang) }}</a>
									</td>
								</tr>
							{% endfor %}
						</tbody>
					</table>
				{% else %}
					<p class="text-gray-600">{{ i18n.t('NO_PRODUCTS', lang) }}</p>
				{% endif %}
			</div>
		</div>

		<!-- Orders Tab -->
		<div id="orders" class="tab-content hidden mt-6">
			<div class="bg-white p-6 rounded-lg shadow-md">
				<h2 class="text-2xl font-semibold mb-4">{{ i18n.t('ORDERS_TITLE', lang) }}</h2>
				{% if orders %}
					<table class="w-full table-auto">
						<thead>
							<tr class="bg-gray-200">
								<th class="px-4 py-2">{{ i18n.t('ORDER_ID', lang) }}</th>
								<th class="px-4 py-2">{{ i18n.t('PRODUCT_NAME', lang) }}</th>
								<th class="px-4 py-2">{{ i18n.t('QUANTITY', lang) }}</th>
								<th class="px-4 py-2">{{ i18n.t('TOTAL_PRICE', lang) }} (TL)</th>
								<th class="px-4 py-2">{{ i18n.t('STATUS', lang) }}</th>
								<th class="px-4 py-2">{{ i18n.t('ACTIONS', lang) }}</th>
							</tr>
						</thead>
						<tbody>
							{% for order in orders %}
								<tr>
									<td class="border px-4 py-2">{{ order.id }}</td>
									<td class="border px-4 py-2">{{ order.product_name }}</td>
									<td class="border px-4 py-2">{{ order.quantity }}</td>
									<td class="border px-4 py-2">{{ order.total_price }}</td>
									<td class="border px-4 py-2">{{ i18n.t('ORDER_STATUS_' + order.status.upper()) }}</td>
									<td class="border px-4 py-2">
										<a href="/dashboard/order/{{ order.id }}" class="text-blue-600 hover:underline">{{ i18n.t('ORDER_DETAILS', lang) }}</a>
										{% if order.status in ['pending', 'pending_payment'] %}
											<a href="/dashboard/cancel_order/{{ order.id }}" class="text-red-600 hover:underline ml-2" onclick="return confirm('{{ i18n.t('ORDER_CANCEL_CONFIRM', lang) }}')">{{ i18n.t('CANCEL', lang) }}</a>
										{% endif %}
									</td>
								</tr>
							{% endfor %}
						</tbody>
					</table>
				{% else %}
					<p class="text-gray-600">{{ i18n.t('NO_ORDERS', lang) }}</p>
				{% endif %}
			</div>
		</div>

		<!-- Statistics Tab -->
		<div id="statistics" class="tab-content hidden mt-6">
			<div class="bg-white p-6 rounded-lg shadow-md">
				<h2 class="text-2xl font-semibold mb-4">{{ i18n.t('STATISTICS_TITLE', lang) }}</h2>
				<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
					<div class="bg-gray-100 p-4 rounded-lg">
						<h3 class="text-lg font-medium">{{ i18n.t('STATISTICS_TOTAL_REVENUE', lang) }}</h3>
						<p class="text-2xl">{{ stats.total_revenue }} TL</p>
					</div>
					<div class="bg-gray-100 p-4 rounded-lg">
						<h3 class="text-lg font-medium">{{ i18n.t('STATISTICS_TOTAL_REFUNDS', lang) }}</h3>
						<p class="text-2xl">{{ stats.total_refunds }} TL</p>
					</div>
					<div class="bg-gray-100 p-4 rounded-lg">
						<h3 class="text-lg font-medium">{{ i18n.t('STATISTICS_TOTAL_TAXES', lang) }}</h3>
						<p class="text-2xl">{{ stats.total_taxes }} TL</p>
					</div>
				</div>
			</div>
		</div>

		<!-- Configuration Tab -->
		<div id="configuration" class="tab-content hidden mt-6">
			<div class="bg-white p-6 rounded-lg shadow-md">
				<h2 class="text-2xl font-semibold mb-4">{{ i18n.t('CONFIGURATION_TITLE', lang) }}</h2>
				<form action="/dashboard/update_config" method="POST" class="space-y-4">
					<div>
						<label for="email" class="block text-sm font-medium text-gray-700">{{ i18n.t('CONFIGURATION_PAPARA_EMAIL', lang) }}</label>
						<input type="email" id="email" name="email" value="{{ user.email }}" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
					</div>
					<div>
						<label for="email_password" class="block text-sm font-medium text-gray-700">{{ i18n.t('CONFIGURATION_EMAIL_PASSWORD', lang) }}</label>
						<input type="password" id="email_password" name="email_password" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
					</div>
					<div>
						<label for="phone" class="block text-sm font-medium text-gray-700">{{ i18n.t('CONFIGURATION_PHONE', lang) }}</label>
						<input type="tel" id="phone" name="phone" value="{{ user.phone }}" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
					</div>
					<div>
						<label for="main_group" class="block text-sm font-medium text-gray-700">{{ i18n.t('CONFIGURATION_MAIN_GROUP', lang) }}</label>
						<input type="number" id="main_group" name="main_group" value="{{ user.main_group }}" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
					</div>
					<button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700">{{ i18n.t('CONFIGURATION_SAVE', lang) }}</button>
				</form>
			</div>
		</div>
	</div>

	<script>
		document.querySelectorAll('.tab-link').forEach(link => {
			link.addEventListener('click', (e) => {
				e.preventDefault();
				const target = e.target.getAttribute('href').substring(1);
				document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
				document.getElementById(target).classList.remove('hidden');
				document.querySelectorAll('.tab-link').forEach(l => l.classList.remove('border-indigo-500', 'text-indigo-600'));
				e.target.classList.add('border-indigo-500', 'text-indigo-600');
			});
		});
		document.getElementById('type').addEventListener('change', (e) => {
			document.getElementById('shipped-fields').classList.add('hidden');
			document.getElementById('membership-fields').classList.add('hidden');
			document.getElementById('download-fields').classList.add('hidden');
			if (e.target.value === 'shipped') {
				document.getElementById('shipped-fields').classList.remove('hidden');
			} else if (e.target.value === 'membership') {
				document.getElementById('membership-fields').classList.remove('hidden');
			} else if (e.target.value === 'download') {
				document.getElementById('download-fields').classList.remove('hidden');
			}
		});
		document.querySelector('.tab-link').click(); // Open first tab by default
	</script>
</body>
</html>